Je veux que tu prépares la configuration de la base de données Supabase pour EasyBet.

Voici ce que tu dois faire pas à pas :

1️⃣ Génère un fichier `backend/schema.sql` contenant le script SQL suivant (copie-le tel quel) :
---------------------------------------------------
-- 1) Types
create type match_status as enum ('upcoming','live','finished','canceled');
create type bet_selection as enum ('home','draw','away');
create type bet_result as enum ('pending','won','lost','void');

-- 2) Tables
create table if not exists public.users_profile (
  user_id uuid primary key references auth.users(id) on delete cascade,
  username text,
  avatar_url text,
  tokens bigint not null default 0,
  diamonds bigint not null default 0,
  total_wins int not null default 0,
  total_losses int not null default 0,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

create table if not exists public.matches (
  id uuid primary key default gen_random_uuid(),
  league text not null,
  home_team text not null,
  away_team text not null,
  start_time timestamptz not null,
  status match_status not null default 'upcoming',
  odds_home numeric(10,2) not null,
  odds_draw numeric(10,2) not null,
  odds_away numeric(10,2) not null,
  image_url text,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

create table if not exists public.bets (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null references auth.users(id) on delete cascade,
  match_id uuid not null references public.matches(id) on delete cascade,
  selection bet_selection not null,
  stake_tokens int not null check (stake_tokens > 0),
  potential_payout_tokens int not null,
  result bet_result not null default 'pending',
  awarded_diamonds int not null default 0,
  created_at timestamptz not null default now(),
  settled_at timestamptz
);

create table if not exists public.tap_events (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null references auth.users(id) on delete cascade,
  tokens_earned int not null check (tokens_earned > 0),
  created_at timestamptz not null default now()
);

-- 3) Leaderboard view
create or replace view public.leaderboard as
select
  u.user_id,
  coalesce(u.username, 'Player') as username,
  u.avatar_url,
  u.diamonds,
  rank() over (order by u.diamonds desc, u.updated_at asc) as rank
from public.users_profile u;

-- 4) Triggers
create or replace function set_updated_at()
returns trigger language plpgsql as $$
begin
  new.updated_at = now();
  return new;
end $$;

drop trigger if exists trg_users_profile_updated on public.users_profile;
create trigger trg_users_profile_updated
before update on public.users_profile
for each row execute procedure set_updated_at();

drop trigger if exists trg_matches_updated on public.matches;
create trigger trg_matches_updated
before update on public.matches
for each row execute procedure set_updated_at();

-- 5) Row Level Security
alter table public.users_profile enable row level security;
alter table public.bets enable row level security;
alter table public.matches enable row level security;
alter table public.tap_events enable row level security;

-- Policies
create policy "profile_select_all" on public.users_profile
  for select using (true);

create policy "profile_update_own" on public.users_profile
  for update using (auth.uid() = user_id);

create policy "bets_select_own" on public.bets
  for select using (auth.uid() = user_id);

create policy "bets_insert_own" on public.bets
  for insert with check (auth.uid() = user_id);

create policy "matches_select_all" on public.matches
  for select using (true);

create policy "tap_select_own" on public.tap_events
  for select using (auth.uid() = user_id);

create policy "tap_insert_own" on public.tap_events
  for insert with check (auth.uid() = user_id);
---------------------------------------------------

2️⃣ Crée aussi un fichier `README_DB.md` à la racine du projet avec les instructions suivantes (en français) :
---------------------------------------------------
# Création du schéma Supabase pour EasyBet

1. Ouvre Supabase dans ton navigateur et connecte-toi à ton projet EasyBet.
2. Va dans **SQL Editor** et clique sur **New query**.
3. Copie-colle le contenu du fichier `backend/schema.sql` et exécute-le.
4. Attends que Supabase crée les types, tables, vues et politiques RLS.  
   - Si tu obtiens une erreur « relation already exists », c’est normal : la structure existe déjà.
5. Une fois le script exécuté avec succès, le schéma est prêt !
---------------------------------------------------

3️⃣ Ne modifie rien d’autre pour l’instant. Informe-moi quand les fichiers sont créés.
